<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>ORM | Faker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1 创建基本类以及生成数据库结构 第一步.在app里的models里写表结构的类   1234567from django.db import models# Create your models here.class UserInofo(models.Model):    # 创建用户名字段，字符串类型，指定长度    username = models.CharField(max_length">
<meta property="og:type" content="website">
<meta property="og:title" content="ORM">
<meta property="og:url" content="https://faker-demoking.github.io/Python/Django/ORM.html">
<meta property="og:site_name" content="Faker">
<meta property="og:description" content="1 创建基本类以及生成数据库结构 第一步.在app里的models里写表结构的类   1234567from django.db import models# Create your models here.class UserInofo(models.Model):    # 创建用户名字段，字符串类型，指定长度    username = models.CharField(max_length">
<meta property="og:locale" content="zh">
<meta property="og:updated_time" content="2019-11-19T17:31:15.192Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ORM">
<meta name="twitter:description" content="1 创建基本类以及生成数据库结构 第一步.在app里的models里写表结构的类   1234567from django.db import models# Create your models here.class UserInofo(models.Model):    # 创建用户名字段，字符串类型，指定长度    username = models.CharField(max_length">
  
    <link rel="alternate" href="/atom.xml" title="Faker" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Faker</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">SKT faker -&gt; demon king</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://faker-demoking.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="page-" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Python/Django/ORM.html" class="article-date">
  <time datetime="2019-11-18T20:05:05.000Z" itemprop="datePublished">2019-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ORM
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-创建基本类以及生成数据库结构"><a href="#1-创建基本类以及生成数据库结构" class="headerlink" title="1 创建基本类以及生成数据库结构"></a>1 创建基本类以及生成数据库结构</h1><ul>
<li><p>第一步.在app里的models里写表结构的类</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInofo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 创建用户名字段，字符串类型，指定长度</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二步.settings里注册app</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'app01'</span>, <span class="comment">#就这么写,app叫啥就写啥</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步.    执行 生成数据库结构</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="1-1-连接mysql"><a href="#1-1-连接mysql" class="headerlink" title="1.1 连接mysql"></a>1.1 连接mysql</h2><pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pip install PyMySQL</span><br><span class="line">pip install mysqlclient</span><br><span class="line">然后修改settings.py的DATABASES</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">    <span class="string">'NAME'</span>:<span class="string">'db_name'</span>,</span><br><span class="line">    <span class="string">'USER'</span>: <span class="string">'db_user'</span>,</span><br><span class="line">    <span class="string">'PASSWORD'</span>: <span class="string">'db_paswd'</span>,</span><br><span class="line">    <span class="string">'HOST'</span>: <span class="string">'db_host'</span>,</span><br><span class="line">    <span class="string">'PORT'</span>: <span class="string">'db_port'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h2 id="1-2-注意"><a href="#1-2-注意" class="headerlink" title="1.2 注意"></a>1.2 注意</h2><p>Django默认使用MySQLdb模块连接数据库，但是在Python3里还没有<br>在项目目录下的<strong>init</strong>.py中写入以下代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h1 id="2-DjangoORM基本增删改查"><a href="#2-DjangoORM基本增删改查" class="headerlink" title="2 DjangoORM基本增删改查"></a>2 DjangoORM基本增删改查</h1><h2 id="2-1-增加"><a href="#2-1-增加" class="headerlink" title="2.1 增加"></a>2.1 增加</h2><ul>
<li><p>方案1</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span><span class="params">(request)</span>:</span></span><br><span class="line">    models.UserInofo.objects.create(</span><br><span class="line">        username=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'123'</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'orm'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方案2</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">models.UserInofo(</span><br><span class="line">        username=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'123'</span>,</span><br><span class="line">    )</span><br><span class="line">obj.save()</span><br></pre></td></tr></table></figure>
</li>
<li><p>方案3</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dic = &#123;<span class="string">'username'</span>:<span class="string">'root'</span>,<span class="string">'password'</span>:<span class="string">'666'</span>&#125;</span><br><span class="line">models.UserInofo.objects.create(**dic)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-2-删除"><a href="#2-2-删除" class="headerlink" title="2.2 删除"></a>2.2 删除</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.UserInofo.objects.filter(username=<span class="string">'root'</span>).delte()</span><br></pre></td></tr></table></figure>

<h2 id="2-3-修改"><a href="#2-3-修改" class="headerlink" title="2.3 修改"></a>2.3 修改</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">models.UserInofo.objects.all().update(password=<span class="string">'666'</span>)</span><br><span class="line">models.UserInofo.objects.filter(id=<span class="number">1</span>).update(password=<span class="string">'666'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-4-查询"><a href="#2-4-查询" class="headerlink" title="2.4 查询"></a>2.4 查询</h2><ul>
<li><p>全部查询</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = models.UserInofo.objects.all()</span><br><span class="line">查询表里所有的行，并返回成一个列表，循环这个res，就可以取值</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> res:</span><br><span class="line">        print(row.id,row.username,row.password)</span><br></pre></td></tr></table></figure>
</li>
<li><p>条件查询</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.UserInofo.objects.filter(username=<span class="string">'root'</span>,password=<span class="string">'123'</span>)</span><br><span class="line">逗号后面加一个条件，就是<span class="keyword">and</span>查询</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-5-ORM字段类型"><a href="#2-5-ORM字段类型" class="headerlink" title="2.5 ORM字段类型"></a>2.5 ORM字段类型</h2><ul>
<li><p>AutoField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AutoField(Field)</span><br><span class="line">    - int自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>BigAutoField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BigAutoField(AutoField)</span><br><span class="line">    - bigint自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">注：当model中如果没有自增列，则自动会创建一个列名为id的列</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 自动创建一个列名为id的且为自增的整数列</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 自定义自增列</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>数字类型</p>
<ul>
<li><p>SmallIntegerField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SmallIntegerField(IntegerField):</span><br><span class="line">    - 小整数 <span class="number">-32768</span> ～ <span class="number">32767</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>PositiveSmallIntegerField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">    - 正小整数 <span class="number">0</span> ～ <span class="number">32767</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>IntegerField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IntegerField(Field)</span><br><span class="line">    - 整数列(有符号的) <span class="number">-2147483648</span> ～ <span class="number">2147483647</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>PositiveIntegerField</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">    - 正整数 <span class="number">0</span> ～ <span class="number">2147483647</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>BigIntegerField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BigIntegerField(IntegerField):</span><br><span class="line">    - 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>自定义无符号整数字段</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class UnsignedIntegerField(models.IntegerField):</span><br><span class="line">    def db_type(self, connection):</span><br><span class="line">        return &apos;integer UNSIGNED&apos;</span><br></pre></td></tr></table></figure>

  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PS: 返回值为字段在数据库中的属性，Django字段默认的值为：</span><br><span class="line">    &apos;AutoField&apos;: &apos;integer AUTO_INCREMENT&apos;,</span><br><span class="line">    &apos;BigAutoField&apos;: &apos;bigint AUTO_INCREMENT&apos;,</span><br><span class="line">    &apos;BinaryField&apos;: &apos;longblob&apos;,</span><br><span class="line">    &apos;BooleanField&apos;: &apos;bool&apos;,</span><br><span class="line">    &apos;CharField&apos;: &apos;varchar(%(max_length)s)&apos;,</span><br><span class="line">    &apos;CommaSeparatedIntegerField&apos;: &apos;varchar(%(max_length)s)&apos;,</span><br><span class="line">    &apos;DateField&apos;: &apos;date&apos;,</span><br><span class="line">    &apos;DateTimeField&apos;: &apos;datetime&apos;,</span><br><span class="line">    &apos;DecimalField&apos;: &apos;numeric(%(max_digits)s, %(decimal_places)s)&apos;,</span><br><span class="line">    &apos;DurationField&apos;: &apos;bigint&apos;,</span><br><span class="line">    &apos;FileField&apos;: &apos;varchar(%(max_length)s)&apos;,</span><br><span class="line">    &apos;FilePathField&apos;: &apos;varchar(%(max_length)s)&apos;,</span><br><span class="line">    &apos;FloatField&apos;: &apos;double precision&apos;,</span><br><span class="line">    &apos;IntegerField&apos;: &apos;integer&apos;,</span><br><span class="line">    &apos;BigIntegerField&apos;: &apos;bigint&apos;,</span><br><span class="line">    &apos;IPAddressField&apos;: &apos;char(15)&apos;,</span><br><span class="line">    &apos;GenericIPAddressField&apos;: &apos;char(39)&apos;,</span><br><span class="line">    &apos;NullBooleanField&apos;: &apos;bool&apos;,</span><br><span class="line">    &apos;OneToOneField&apos;: &apos;integer&apos;,</span><br><span class="line">    &apos;PositiveIntegerField&apos;: &apos;integer UNSIGNED&apos;,</span><br><span class="line">    &apos;PositiveSmallIntegerField&apos;: &apos;smallint UNSIGNED&apos;,</span><br><span class="line">    &apos;SlugField&apos;: &apos;varchar(%(max_length)s)&apos;,</span><br><span class="line">    &apos;SmallIntegerField&apos;: &apos;smallint&apos;,</span><br><span class="line">    &apos;TextField&apos;: &apos;longtext&apos;,</span><br><span class="line">    &apos;TimeField&apos;: &apos;time&apos;,</span><br><span class="line">    &apos;UUIDField&apos;: &apos;char(32)&apos;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>BooleanField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BooleanField(Field)</span><br><span class="line">    - 布尔值类型</span><br></pre></td></tr></table></figure>
</li>
<li><p>NullBooleanField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NullBooleanField(Field):</span><br><span class="line">    - 可以为空的布尔值</span><br></pre></td></tr></table></figure>
</li>
<li><p>CharField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CharField(Field)</span><br><span class="line">    - 字符类型</span><br><span class="line">    - 必须提供max_length参数， max_length表示字符长度</span><br></pre></td></tr></table></figure>
</li>
<li><p>TextField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextField(Field)</span><br><span class="line">    - 文本类型</span><br></pre></td></tr></table></figure>
</li>
<li><p>EmailField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EmailField(CharField)：</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证机制</span><br></pre></td></tr></table></figure>
</li>
<li><p>IPAddressField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IPAddressField(Field)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br></pre></td></tr></table></figure>
</li>
<li><p>GenericIPAddressField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GenericIPAddressField(Field)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line">    - 参数：</span><br><span class="line">        protocol，用于指定Ipv4或Ipv6， &apos;both&apos;,&quot;ipv4&quot;,&quot;ipv6&quot;</span><br><span class="line">        unpack_ipv4， 如果指定为True，则输入::ffff:192.0.2.1时候，可解析为192.0.2.1，开启刺功能，需要protocol=&quot;both&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>URLField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URLField(CharField)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br></pre></td></tr></table></figure>
</li>
<li><p>SlugField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SlugField(CharField)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br></pre></td></tr></table></figure>
</li>
<li><p>CommaSeparatedIntegerField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CommaSeparatedIntegerField(CharField)</span><br><span class="line">    - 字符串类型，格式必须为逗号分割的数字</span><br></pre></td></tr></table></figure>
</li>
<li><p>UUIDField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UUIDField(Field)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br></pre></td></tr></table></figure>
</li>
<li><p>FilePathField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FilePathField(Field)</span><br><span class="line">    - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">    - 参数：</span><br><span class="line">            path,                      文件夹路径</span><br><span class="line">            match=None,                正则匹配</span><br><span class="line">            recursive=False,           递归下面的文件夹</span><br><span class="line">            allow_files=True,          允许文件</span><br><span class="line">            allow_folders=False,       允许文件夹</span><br></pre></td></tr></table></figure>
</li>
<li><p>FileField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FileField(Field)</span><br><span class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">    - 参数：</span><br><span class="line">        upload_to = &quot;&quot;      上传文件的保存路径</span><br><span class="line">        storage = None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br></pre></td></tr></table></figure>
</li>
<li><p>ImageField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ImageField(FileField)</span><br><span class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">    - 参数：</span><br><span class="line">        upload_to = &quot;&quot;      上传文件的保存路径</span><br><span class="line">        storage = None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">        width_field=None,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">        height_field=None   上传图片的宽度保存的数据库字段名（字符串）</span><br></pre></td></tr></table></figure>
</li>
<li><p>DateTimeField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DateTimeField(DateField)</span><br><span class="line">    - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>DateField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DateField(DateTimeCheckMixin, Field)</span><br><span class="line">    - 日期格式      YYYY-MM-DD</span><br></pre></td></tr></table></figure>
</li>
<li><p>TimeField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">    - 时间格式      HH:MM[:ss[.uuuuuu]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>DurationField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DurationField(Field)</span><br><span class="line">    - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br></pre></td></tr></table></figure>
</li>
<li><p>FloatField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FloatField(Field)</span><br><span class="line">    - 浮点型</span><br></pre></td></tr></table></figure>
</li>
<li><p>DecimalField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DecimalField(Field)</span><br><span class="line">    - 10进制小数</span><br><span class="line">    - 参数：</span><br><span class="line">        max_digits，小数总长度</span><br><span class="line">        decimal_places，小数位长度</span><br></pre></td></tr></table></figure>
</li>
<li><p>BinaryField</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BinaryField(Field)</span><br><span class="line">    - 二进制类型</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-6-ORM字段参数"><a href="#2-6-ORM字段参数" class="headerlink" title="2.6 ORM字段参数"></a>2.6 ORM字段参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">default             数据库中字段的默认值</span><br><span class="line">primary_key         数据库中字段是否为主键</span><br><span class="line">db_index            数据库中字段是否可以建立索引</span><br><span class="line">unique              数据库中字段是否可以建立唯一索引</span><br><span class="line">unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引</span><br><span class="line">unique_for_month    数据库中字段【月】部分是否可以建立唯一索引</span><br><span class="line">unique_for_year     数据库中字段【年】部分是否可以建立唯一索引</span><br><span class="line"></span><br><span class="line">verbose_name        Admin中显示的字段名称</span><br><span class="line">blank               Admin中是否允许用户输入为空</span><br><span class="line">editable            Admin中是否可以编辑</span><br><span class="line">help_text           Admin中该字段的提示信息</span><br><span class="line">choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作</span><br><span class="line">                    如：gf = models.IntegerField(choices=[(<span class="number">0</span>, <span class="string">'何穗'</span>),(<span class="number">1</span>, <span class="string">'大表姐'</span>),],default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；</span><br><span class="line">                    字典健：null, blank, invalid, invalid_choice, unique, <span class="keyword">and</span> unique_for_date</span><br><span class="line">                    如：&#123;<span class="string">'null'</span>: <span class="string">"不能为空."</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>&#125;</span><br><span class="line"></span><br><span class="line">validators          自定义错误验证（列表类型），从而定制想要的验证规则</span><br><span class="line">                    <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line">                    <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> EmailValidator,URLValidator,DecimalValidator,\</span><br><span class="line">                    MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator</span><br><span class="line">                    如：</span><br><span class="line">                        test = models.CharField(</span><br><span class="line">                            max_length=<span class="number">32</span>,</span><br><span class="line">                            error_messages=&#123;</span><br><span class="line">                                <span class="string">'c1'</span>: <span class="string">'优先错信息1'</span>,</span><br><span class="line">                                <span class="string">'c2'</span>: <span class="string">'优先错信息2'</span>,</span><br><span class="line">                                <span class="string">'c3'</span>: <span class="string">'优先错信息3'</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            validators=[</span><br><span class="line">                                RegexValidator(regex=<span class="string">'root_\d+'</span>, message=<span class="string">'错误了'</span>, code=<span class="string">'c1'</span>),</span><br><span class="line">                                RegexValidator(regex=<span class="string">'root_112233\d+'</span>, message=<span class="string">'又错误了'</span>, code=<span class="string">'c2'</span>),</span><br><span class="line">                                EmailValidator(message=<span class="string">'又错误了'</span>, code=<span class="string">'c3'</span>), ]</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">    unique_for_date <span class="comment">#只对时间做索引</span></span><br><span class="line"></span><br><span class="line">    unique_for_month     <span class="comment">#只对月分做索引</span></span><br><span class="line"></span><br><span class="line">    unique_for_year</span><br><span class="line">　　auto_now  <span class="comment">#更新时，自动更新为当前时间</span></span><br><span class="line"></span><br><span class="line">    auto_now_add <span class="comment">#创建时，自动生成</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">注意：auto_now,auto_now_add,choince使用</span><br><span class="line">　　obj=UserGroup.objects.filter(id=<span class="number">1</span>).update(caption=<span class="string">"CEO"</span>)<span class="comment">#这种方式utime不会更新</span></span><br><span class="line">　　<span class="comment">#下面方式更新 utime</span></span><br><span class="line">　　obj=UserGroup.objects.filter(id=<span class="number">1</span>).filter()</span><br><span class="line">　　obj.caption=<span class="string">"CEO"</span></span><br><span class="line">　　obj.save()</span><br><span class="line"></span><br><span class="line">auto_now  <span class="comment">#更新时，自动更新为当前时间</span></span><br><span class="line">auto_now_add <span class="comment">#创建时，自动生成</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroup</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    uid=models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    caption=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    ctime=models.DateTimeField(auto_now_add=<span class="literal">True</span>,null=<span class="literal">True</span>)</span><br><span class="line">    utime=models.DateTimeField(auto_now=<span class="literal">True</span>,null=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">obj=UserGroup.objects.filter(id=<span class="number">1</span>).update(caption=<span class="string">"CEO"</span>)<span class="comment">#这种方式utime不会更新</span></span><br><span class="line"><span class="comment">#下面方式更新 utime</span></span><br><span class="line">obj=UserGroup.objects.filter(id=<span class="number">1</span>).filter()</span><br><span class="line">obj.caption=<span class="string">"CEO"</span></span><br><span class="line">obj.save()</span><br></pre></td></tr></table></figure>

<ul>
<li>choices,给django admin显示下拉框，避免连表查询  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user_type_choices=(</span><br><span class="line">(1,&quot;超级用户&quot;),</span><br><span class="line">(2,&quot;普通用户&quot;),</span><br><span class="line">(3,&quot;用户&quot;),</span><br><span class="line"></span><br><span class="line">)#这里是放在内存里面</span><br><span class="line">user_type_id=models.IntegerField(choices=user_type_choices,default=1) #给django admin显示下拉框，避免连表查询</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-7-外键操作"><a href="#2-7-外键操作" class="headerlink" title="2.7 外键操作"></a>2.7 外键操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_group_id = models.ForeignKey(<span class="string">"UserGroup"</span>,to_field=<span class="string">'uid'</span>,default=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># ForeignKey 关联哪个表，to_field 关联哪个字段,default是创建时默认给的数值</span></span><br></pre></td></tr></table></figure>

<h2 id="2-8-一对多创建"><a href="#2-8-一对多创建" class="headerlink" title="2.8 一对多创建"></a>2.8 一对多创建</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Business</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.BigAutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    caption = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.BigAutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line">    ip = models.GenericIPAddressField(protocol=<span class="string">"ipv4"</span>,db_index=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># IPAddressField将要被移除了，这个支持IPV6</span></span><br><span class="line">    <span class="comment"># protocol参数默认是ipv4，ipv4和ipv6都支持</span></span><br><span class="line">    port = models.IntegerField()</span><br><span class="line">    b_id = models.ForeignKey(to=<span class="string">"Business"</span>,on_delete=<span class="string">"DO_NOTHING"</span>,to_field=<span class="string">"id"</span>)</span><br></pre></td></tr></table></figure>

<p>当我想要为某个表再加一个字段的时候怎么搞呢？直接写，然后migrate吗？<br><code>code = models.CharField(max_length=32)</code><br>这样就会有个问题，他一定会提醒你，让你填个字符串，因为默认不为空。<br>那么这个时候加一个<code>null=True</code>，就可以默认为空，或者写个<code>default=&quot;default&quot;</code>，<br>这个时候，加字段时默认值为<code>default</code></p>
<h2 id="2-9-一对多跨表操作"><a href="#2-9-一对多跨表操作" class="headerlink" title="2.9 一对多跨表操作"></a>2.9 一对多跨表操作</h2><ul>
<li><p>查询</p>
<ul>
<li><p>方案1</p>
<ul>
<li><p>py代码</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">business</span><span class="params">(request)</span>:</span></span><br><span class="line">    v = models.Business.objects.all() <span class="comment"># 查询所有，返回对象</span></span><br><span class="line">    v2 = models.Business.objects.all().values(<span class="string">'id'</span>,<span class="string">'caption'</span>) <span class="comment">#查询两个字段，返回字典格式</span></span><br><span class="line">    v3 = models.Business.objects.all().values_list(<span class="string">'id'</span>,<span class="string">'caption'</span>) <span class="comment">#查询两个字段，返回元组格式</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'business.html'</span>,&#123;<span class="string">'v'</span>:v,<span class="string">'v2'</span>:v2,<span class="string">'v3'</span>:v3&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>html代码</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>业务线列表（对象）<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in v %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.id &#125;&#125; - &#123;&#123; row.caption &#125;&#125; - &#123;&#123; row.code &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>业务线列表（字典）<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in v2 %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.id &#125;&#125; - &#123;&#123; row.caption &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>业务线列表（元组）<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in v3 %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.0 &#125;&#125; - &#123;&#123; row.1 &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>方案2</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">host</span><span class="params">(request)</span>:</span></span><br><span class="line">    v1 = models.Host.objects.filter(id__gt=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v1:</span><br><span class="line">        print(i.id,i.hostname,i.ip,i.port,,i.b,i.b_id)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Host"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用外键</p>
</li>
</ul>
<p>这里的b和b_id是什么呢？<br>b 其实是个对象，是关联的那张表的数据，里面封装了business表中的字段数据b_id其实就是一个数字，对应的是business表中的id<br>那么有了对象我是不是也可以像查询这张表一样，只需要加一个点什么什么就可以取到另一张表里的字段呢，答案是肯定的<br>如下:</p>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">host</span><span class="params">(request)</span>:</span></span><br><span class="line">    v1 = models.Host.objects.filter(id__gt=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v1:</span><br><span class="line">        print(i.id,i.hostname,i.ip,i.port,,i.b.id,i.b.caption,i.b_id)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Host"</span>)</span><br><span class="line">输出：</span><br><span class="line">    <span class="number">1</span> web<span class="number">-1</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">1</span> <span class="number">1</span> faker <span class="number">1</span></span><br><span class="line">    <span class="number">2</span> web<span class="number">-2</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">2</span> <span class="number">2</span> bang <span class="number">2</span></span><br><span class="line">    <span class="number">3</span> web<span class="number">-3</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">3</span> <span class="number">3</span> wolf <span class="number">3</span></span><br></pre></td></tr></table></figure></code></pre><ul>
<li>双下划线操作多对多  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 到这里你可能会觉得很牛逼，其实不然，还有一种，我前面说到的__双下划线，</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">host</span><span class="params">(request)</span>:</span></span><br><span class="line">    v1 = models.Host.objects.filter(id__gt=<span class="number">0</span>).values(<span class="string">'id'</span>,<span class="string">'hostname'</span>,<span class="string">'b_id'</span>,<span class="string">'b__caption'</span>) <span class="comment"># 这个神奇的双下划线</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v1:</span><br><span class="line">        print(i[<span class="string">'id'</span>],i[<span class="string">'hostname'</span>],i[<span class="string">'b_id'</span>],i[<span class="string">'b__caption'</span>])</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Host"</span>)</span><br><span class="line">输出：</span><br><span class="line">    <span class="number">1</span> web<span class="number">-1</span> <span class="number">1</span> faker</span><br><span class="line">    <span class="number">2</span> web<span class="number">-2</span> <span class="number">2</span> bang</span><br><span class="line">    <span class="number">3</span> web<span class="number">-3</span> <span class="number">3</span> wolf</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-10-多对多跨表操作"><a href="#2-10-多对多跨表操作" class="headerlink" title="2.10 多对多跨表操作"></a>2.10 多对多跨表操作</h2><h3 id="2-10-1-创建多对多关系"><a href="#2-10-1-创建多对多关系" class="headerlink" title="2.10.1 创建多对多关系"></a>2.10.1 创建多对多关系</h3><ul>
<li><p>方式1：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.BigAutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HostToApp</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    hobj= models.ForeignKey(to=<span class="string">'Host'</span>,on_delete=<span class="string">"DO_NOTHING"</span>,to_field=<span class="string">'id'</span>)</span><br><span class="line">    aobj = models.ForeignKey(to=<span class="string">'Application'</span>,on_delete=<span class="string">"DO_NOTHING"</span>,to_field=<span class="string">'id'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式2：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.BigAutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    host = models.ManyToManyField(<span class="string">'Host'</span>)</span><br><span class="line">    <span class="comment"># 我只需要用这一个就好了</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>那么你会问了，哪种好呢？<br>第一种可以自定义，第二种更快，但是它只能有关联的id</p>
<h3 id="2-10-2-操作第三张表"><a href="#2-10-2-操作第三张表" class="headerlink" title="2.10.2 操作第三张表"></a>2.10.2 操作第三张表</h3><ul>
<li><p>查询</p>
<ul>
<li><p>py代码</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app</span><span class="params">(request)</span>:</span></span><br><span class="line">    app_list = models.Application.objects.all()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> app_list:</span><br><span class="line">        print(row.name,row.host.all())</span><br><span class="line">        <span class="comment"># row.host 获取到第三张表的对象，.all获取里面的内容</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app.html'</span>,&#123;<span class="string">'app_list'</span>:app_list&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>html代码</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>应用列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>应用名称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>应用主机列表<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> &gt;</span></span><br><span class="line">            &#123;% for app in app_list %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; app.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        &#123;% for host in app.host.all %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; host.hostname &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="2-11-神奇的双下划线"><a href="#2-11-神奇的双下划线" class="headerlink" title="2.11 神奇的双下划线"></a>2.11 神奇的双下划线</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__exact        精确等于 like &apos;aaa&apos;</span><br><span class="line">__iexact    精确等于 忽略大小写 ilike &apos;aaa&apos;</span><br><span class="line">__contains    包含 like &apos;%aaa%&apos;</span><br><span class="line">__icontains    包含 忽略大小写 ilike &apos;%aaa%&apos;，但是对于sqlite来说，contains的作用效果等同于icontains。</span><br><span class="line">__gt    大于</span><br><span class="line">__gte    大于等于</span><br><span class="line">__lt    小于</span><br><span class="line">__lte    小于等于</span><br><span class="line">__in     存在于一个list范围内</span><br><span class="line">__startswith   以...开头</span><br><span class="line">__istartswith   以...开头 忽略大小写</span><br><span class="line">__endswith     以...结尾</span><br><span class="line">__iendswith    以...结尾，忽略大小写</span><br><span class="line">__range    在...范围内</span><br><span class="line">__year       日期字段的年份</span><br><span class="line">__month    日期字段的月份</span><br><span class="line">__day        日期字段的日</span><br><span class="line">__isnull=True/False</span><br><span class="line">__isnull=True 与 __exact=None的区别</span><br></pre></td></tr></table></figure>

<h2 id="2-12-Model补充"><a href="#2-12-Model补充" class="headerlink" title="2.12 Model补充"></a>2.12 Model补充</h2><h3 id="2-12-1-自定制表名"><a href="#2-12-1-自定制表名" class="headerlink" title="2.12.1 自定制表名"></a>2.12.1 自定制表名</h3><p><strong>前面我们创建表，表名都是app名称+下划线+类名，我们也可以自定制表名</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'tb1'</span></span><br></pre></td></tr></table></figure>

<h3 id="2-12-2-联合索引"><a href="#2-12-2-联合索引" class="headerlink" title="2.12.2 联合索引"></a>2.12.2 联合索引</h3><ul>
<li>平常创建索引是如下方式  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line">email = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>这时候就是一列一个索引，这个时候我们查找name会触发索引，email也是，索引每创建一个，就会创建一个文件存储索引,我们可以创建一个联合索引，存储在一个文件里，但是这样的查询的时候也是有代价的，这时候命中索引的时候，是最左前缀的模式，意思就是当我查询name的时候或者查询name and email的时候会命中索引，但是当我单独查询email的时候就无法命中索引了</p>
<ul>
<li>联合索引  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index_together = [</span><br><span class="line">    (<span class="string">'name'</span>,<span class="string">'email'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>这个时候你就会说了，那这个有个卵用？当然有用，在某些场景，比如用户名+密码，是不是联合索引？谁没事儿拿个密码去查询东西？</p>
<h3 id="2-12-3-联合唯一索引"><a href="#2-12-3-联合唯一索引" class="headerlink" title="2.12.3 联合唯一索引"></a>2.12.3 联合唯一索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unique_together = ((&quot;user&quot;,&quot;password&quot;),)</span><br><span class="line">	意思就是加起来，是在整个表里唯一的</span><br></pre></td></tr></table></figure>

<h3 id="2-12-4-多表关系以及参数"><a href="#2-12-4-多表关系以及参数" class="headerlink" title="2.12.4 多表关系以及参数"></a>2.12.4 多表关系以及参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">ForeignKey(ForeignObject) # ForeignObject(RelatedField)</span><br><span class="line">        to,                         # 要进行关联的表名</span><br><span class="line">        to_field=None,              # 要关联的表中的字段名称</span><br><span class="line">        on_delete=None,             # 当删除关联表中的数据时，当前表与其关联的行的行为</span><br><span class="line">                                        - models.CASCADE，删除关联数据，与之关联也删除</span><br><span class="line">                                        - models.DO_NOTHING，删除关联数据，引发错误IntegrityError</span><br><span class="line">                                        - models.PROTECT，删除关联数据，引发错误ProtectedError</span><br><span class="line">                                        - models.SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span><br><span class="line">                                        - models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span><br><span class="line">                                        - models.SET，删除关联数据，</span><br><span class="line">                                                      a. 与之关联的值设置为指定值，设置：models.SET(值)</span><br><span class="line">                                                      b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span><br><span class="line"></span><br><span class="line">                                                        def func():</span><br><span class="line">                                                            return 10</span><br><span class="line"></span><br><span class="line">                                                        class MyModel(models.Model):</span><br><span class="line">                                                            user = models.ForeignKey(</span><br><span class="line">                                                                to=&quot;User&quot;,</span><br><span class="line">                                                                to_field=&quot;id&quot;</span><br><span class="line">                                                                on_delete=models.SET(func),)</span><br><span class="line">        related_name=None,          # 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span><br><span class="line">        related_query_name=None,    # 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values(&apos;表名__字段名&apos;)</span><br><span class="line">        limit_choices_to=None,      # 在Admin或ModelForm中显示关联数据时，提供的条件：</span><br><span class="line">                                    # 如：</span><br><span class="line">                                            - limit_choices_to=&#123;&apos;nid__gt&apos;: 5&#125;</span><br><span class="line">                                            - limit_choices_to=lambda : &#123;&apos;nid__gt&apos;: 5&#125;</span><br><span class="line"></span><br><span class="line">                                            from django.db.models import Q</span><br><span class="line">                                            - limit_choices_to=Q(nid__gt=10)</span><br><span class="line">                                            - limit_choices_to=Q(nid=8) | Q(nid__gt=10)</span><br><span class="line">                                            - limit_choices_to=lambda : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=&apos;root&apos;)</span><br><span class="line">        db_constraint=True          # 是否在数据库中创建外键约束</span><br><span class="line">        parent_link=False           # 在Admin中是否显示关联数据</span><br><span class="line"></span><br><span class="line">    OneToOneField(ForeignKey)</span><br><span class="line">        to,                         # 要进行关联的表名</span><br><span class="line">        to_field=None               # 要关联的表中的字段名称</span><br><span class="line">        on_delete=None,             # 当删除关联表中的数据时，当前表与其关联的行的行为</span><br><span class="line"></span><br><span class="line">                                    ###### 对于一对一 ######</span><br><span class="line">                                    # 1. 一对一其实就是 一对多 + 唯一索引</span><br><span class="line">                                    # 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span><br><span class="line">                                    # 如下会在A表中额外增加一个c_ptr_id列且唯一：</span><br><span class="line">                                            class C(models.Model):</span><br><span class="line">                                                nid = models.AutoField(primary_key=True)</span><br><span class="line">                                                part = models.CharField(max_length=12)</span><br><span class="line"></span><br><span class="line">                                            class A(C):</span><br><span class="line">                                                id = models.AutoField(primary_key=True)</span><br><span class="line">                                                code = models.CharField(max_length=1)</span><br><span class="line"></span><br><span class="line">    ManyToManyField(RelatedField)</span><br><span class="line">        to,                         # 要进行关联的表名</span><br><span class="line">        related_name=None,          # 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span><br><span class="line">        related_query_name=None,    # 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values(&apos;表名__字段名&apos;)</span><br><span class="line">        limit_choices_to=None,      # 在Admin或ModelForm中显示关联数据时，提供的条件：</span><br><span class="line">                                    # 如：</span><br><span class="line">                                            - limit_choices_to=&#123;&apos;nid__gt&apos;: 5&#125;</span><br><span class="line">                                            - limit_choices_to=lambda : &#123;&apos;nid__gt&apos;: 5&#125;</span><br><span class="line"></span><br><span class="line">                                            from django.db.models import Q</span><br><span class="line">                                            - limit_choices_to=Q(nid__gt=10)</span><br><span class="line">                                            - limit_choices_to=Q(nid=8) | Q(nid__gt=10)</span><br><span class="line">                                            - limit_choices_to=lambda : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=&apos;root&apos;)</span><br><span class="line">        symmetrical=None,           # 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span><br><span class="line">                                    # 做如下操作时，不同的symmetrical会有不同的可选字段</span><br><span class="line">                                        models.BB.objects.filter(...)</span><br><span class="line"></span><br><span class="line">                                        # 可选字段有：code, id, m1</span><br><span class="line">                                            class BB(models.Model):</span><br><span class="line"></span><br><span class="line">                                            code = models.CharField(max_length=12)</span><br><span class="line">                                            m1 = models.ManyToManyField(&apos;self&apos;,symmetrical=True)</span><br><span class="line"></span><br><span class="line">                                        # 可选字段有: bb, code, id, m1</span><br><span class="line">                                            class BB(models.Model):</span><br><span class="line"></span><br><span class="line">                                            code = models.CharField(max_length=12)</span><br><span class="line">                                            m1 = models.ManyToManyField(&apos;self&apos;,symmetrical=False)</span><br><span class="line"></span><br><span class="line">        through=None,               # 自定义第三张表时，使用字段用于指定关系表</span><br><span class="line">        through_fields=None,        # 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span><br><span class="line">                                        from django.db import models</span><br><span class="line"></span><br><span class="line">                                        class Person(models.Model):</span><br><span class="line">                                            name = models.CharField(max_length=50)</span><br><span class="line"></span><br><span class="line">                                        class Group(models.Model):</span><br><span class="line">                                            name = models.CharField(max_length=128)</span><br><span class="line">                                            members = models.ManyToManyField(</span><br><span class="line">                                                Person,</span><br><span class="line">                                                through=&apos;Membership&apos;,</span><br><span class="line">                                                through_fields=(&apos;group&apos;, &apos;person&apos;),</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                                        class Membership(models.Model):</span><br><span class="line">                                            group = models.ForeignKey(Group, on_delete=models.CASCADE)</span><br><span class="line">                                            person = models.ForeignKey(Person, on_delete=models.CASCADE)</span><br><span class="line">                                            inviter = models.ForeignKey(</span><br><span class="line">                                                Person,</span><br><span class="line">                                                on_delete=models.CASCADE,</span><br><span class="line">                                                related_name=&quot;membership_invites&quot;,</span><br><span class="line">                                            )</span><br><span class="line">                                            invite_reason = models.CharField(max_length=64)</span><br><span class="line">        db_constraint=True,         # 是否在数据库中创建外键约束</span><br><span class="line">        db_table=None,              # 默认创建第三张表时，数据库中表的名称</span><br></pre></td></tr></table></figure>

<h2 id="2-13-反向操作"><a href="#2-13-反向操作" class="headerlink" title="2.13 反向操作"></a>2.13 反向操作</h2><ul>
<li>Models.py  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"user"</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line">    passwd = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    ut = models.ForeignKey(to=<span class="string">'UserType'</span>,to_field=<span class="string">'id'</span>,on_delete=<span class="string">"None"</span>,related_name=<span class="string">'user_rev'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"user_type"</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-14-数据验证以及钩子"><a href="#2-14-数据验证以及钩子" class="headerlink" title="2.14 数据验证以及钩子"></a>2.14 数据验证以及钩子</h2><h3 id="2-14-1-数据验证"><a href="#2-14-1-数据验证" class="headerlink" title="2.14.1 数据验证"></a>2.14.1 数据验证</h3><ul>
<li><p>1.Models.py</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'use_info'</span></span><br><span class="line">    name= models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.EmailField() <span class="comment"># 我们对他做验证</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.views.py</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    obj = models.UserInfo(name=<span class="string">'root'</span>,email=<span class="string">'root'</span>)</span><br><span class="line">    obj.full_clean() <span class="comment"># 这个方法就是帮我们做验证,验证不通过直接返回错误</span></span><br><span class="line">    obj.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"OK"</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-14-2-钩子"><a href="#2-14-2-钩子" class="headerlink" title="2.14.2 钩子"></a>2.14.2 钩子</h3><p><strong>上面的那个full_clean方法其实就是django给我们预留的一个钩子，我们还可以自定义</strong>  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'use_info'</span></span><br><span class="line">    name= models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.EmailField() <span class="comment"># 我们对他做验证</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></span><br><span class="line">        o = UserInfo.objects.filter(name=self.name).count()</span><br><span class="line">        <span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line">        <span class="keyword">if</span> o:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(message=<span class="string">"用户名已经存在"</span>,code=<span class="string">'i1'</span>)</span><br><span class="line">    <span class="comment"># 当full_clean方法判断完传来的数据满足正则表达式（父类的方法）后，</span></span><br><span class="line">    <span class="comment"># 会执行这个clean方法，在这里我们再做其他判断，比如这里，</span></span><br><span class="line">    <span class="comment"># 判断了name是否存在，如果存在就抛出ValidationError这个错误，并定义了错误信息，由父类返回</span></span><br></pre></td></tr></table></figure>

<h2 id="2-15-元数据"><a href="#2-15-元数据" class="headerlink" title="2.15 元数据"></a>2.15 元数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    <span class="comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></span><br><span class="line">    db_table = <span class="string">"table_name"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 联合索引</span></span><br><span class="line">    index_together = [</span><br><span class="line">        (<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 联合唯一索引</span></span><br><span class="line">    unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># admin中显示的表名称</span></span><br><span class="line">    verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># verbose_name加s</span></span><br><span class="line">    verbose_name_plural</span><br></pre></td></tr></table></figure>

<h2 id="2-16-其他用法"><a href="#2-16-其他用法" class="headerlink" title="2.16 其他用法"></a>2.16 其他用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.cnblogs.com/wupeiqi/articles/6216618.html</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://faker-demoking.github.io/Python/Django/ORM.html" data-id="ck36ar4w700189ourz4haxdyp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/10/08/index/">目录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Daniel<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>
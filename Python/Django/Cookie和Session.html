<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Cookie和Session | Faker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1 CookieCookie是客户端浏览器上存储的一个键值对,记录着你当前登录的用户信息,当你下次登录的时候会带着这段cookie信息，如果有的话就不用在输入密码了，直接给你返回页面,关闭浏览器就不生效了 1.1 小例子： py文件   123456789101112131415161718192021222324user_info = &amp;#123;    &apos;root&apos;:&amp;#123;&apos;pwd&apos;:&apos;">
<meta property="og:type" content="website">
<meta property="og:title" content="Cookie和Session">
<meta property="og:url" content="https://faker-demoking.github.io/Python/Django/Cookie和Session.html">
<meta property="og:site_name" content="Faker">
<meta property="og:description" content="1 CookieCookie是客户端浏览器上存储的一个键值对,记录着你当前登录的用户信息,当你下次登录的时候会带着这段cookie信息，如果有的话就不用在输入密码了，直接给你返回页面,关闭浏览器就不生效了 1.1 小例子： py文件   123456789101112131415161718192021222324user_info = &amp;#123;    &apos;root&apos;:&amp;#123;&apos;pwd&apos;:&apos;">
<meta property="og:locale" content="zh">
<meta property="og:updated_time" content="2019-11-18T19:05:34.306Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cookie和Session">
<meta name="twitter:description" content="1 CookieCookie是客户端浏览器上存储的一个键值对,记录着你当前登录的用户信息,当你下次登录的时候会带着这段cookie信息，如果有的话就不用在输入密码了，直接给你返回页面,关闭浏览器就不生效了 1.1 小例子： py文件   123456789101112131415161718192021222324user_info = &amp;#123;    &apos;root&apos;:&amp;#123;&apos;pwd&apos;:&apos;">
  
    <link rel="alternate" href="/atom.xml" title="Faker" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Faker</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">SKT faker -&gt; demon king</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://faker-demoking.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="page-" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Python/Django/Cookie和Session.html" class="article-date">
  <time datetime="2019-11-18T18:59:48.000Z" itemprop="datePublished">2019-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cookie和Session
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Cookie"><a href="#1-Cookie" class="headerlink" title="1 Cookie"></a>1 Cookie</h1><p><strong>Cookie是客户端浏览器上存储的一个键值对,记录着你当前登录的用户信息,当你下次登录的时候会带着这段cookie信息，如果有的话就不用在输入密码了，直接给你返回页面,关闭浏览器就不生效了</strong></p>
<h1 id="1-1-小例子："><a href="#1-1-小例子：" class="headerlink" title="1.1 小例子："></a>1.1 小例子：</h1><ul>
<li><p>py文件</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">user_info = &#123;</span><br><span class="line">    <span class="string">'root'</span>:&#123;<span class="string">'pwd'</span>:<span class="string">'123.com'</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = request.POST.get(<span class="string">'user'</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">'pwd'</span>)</span><br><span class="line">        dic = user_info.get(user)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> dic:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line">        <span class="keyword">if</span> dic[<span class="string">'pwd'</span>] == pwd:</span><br><span class="line">            res = redirect(<span class="string">'/index/'</span>)       <span class="comment"># 生成一个对象redirect</span></span><br><span class="line">            res.set_cookie(<span class="string">'username'</span>,user) <span class="comment"># 这里设置个cookie</span></span><br><span class="line">            <span class="keyword">return</span>  res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    status = <span class="string">'no'</span></span><br><span class="line">    v = request.COOKIES.get(<span class="string">'username'</span>)</span><br><span class="line">    <span class="keyword">if</span> v:</span><br><span class="line">        status = <span class="string">'ok'</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(status)</span><br></pre></td></tr></table></figure>
</li>
<li><p>html文件</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'user'</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'pwd'</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="1-2-django提供的cookie方法"><a href="#1-2-django提供的cookie方法" class="headerlink" title="1.2 django提供的cookie方法"></a>1.2 django提供的cookie方法</h2><ul>
<li><p>获取</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.COOKIES <span class="comment"># 返回一个字典</span></span><br><span class="line">request.COOKIES[<span class="string">'user'</span>] <span class="comment"># 返回字典里的某个值</span></span><br><span class="line">request.COOKIES.get(<span class="string">'user'</span>) <span class="comment"># 同上</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">res = render(request,<span class="string">'xxx.html'</span>)</span><br><span class="line">res = redirect(<span class="string">'/index/'</span>)</span><br><span class="line"><span class="comment"># 先创建一个对象</span></span><br><span class="line"><span class="comment"># 然后再设置</span></span><br><span class="line">res.set_cookie(<span class="string">'key'</span>,<span class="string">'value'</span>)</span><br><span class="line"><span class="comment"># set_cookie里的参数</span></span><br><span class="line">    key             <span class="comment"># 键</span></span><br><span class="line">    value=<span class="string">''</span>        <span class="comment"># 值</span></span><br><span class="line">    max_age=<span class="literal">None</span>    <span class="comment"># 超时时间 单位：秒</span></span><br><span class="line">    expires=<span class="literal">None</span>    <span class="comment"># 超时时间 可以根据自己的设置来，譬如:</span></span><br><span class="line">        <span class="keyword">import</span> datetime</span><br><span class="line">        current_date = datetime.datetime.utcnow()</span><br><span class="line">        res.set_cookie(<span class="string">'key'</span>,<span class="string">'value'</span>,expires=current_date) <span class="comment"># 这就表示到哪个时间生效</span></span><br><span class="line">    path=<span class="string">'/'</span>        <span class="comment"># 生效的路径,'/'根路径表示特殊的，根路径的cookie可以被任何url访问到</span></span><br><span class="line">    domain=<span class="literal">None</span>     <span class="comment"># 生效的domain</span></span><br><span class="line">    secure=<span class="literal">False</span>    <span class="comment"># https传输</span></span><br><span class="line">    httponly=<span class="literal">False</span>  <span class="comment"># True 的话通过前端的js代码不能获取到,相对安全</span></span><br><span class="line">    samesite=<span class="literal">None</span>   <span class="comment"># SameSite Cookie，防止 CSRF 攻击</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="1-3-小例子之基于cookie实现定制显示数据条数"><a href="#1-3-小例子之基于cookie实现定制显示数据条数" class="headerlink" title="1.3 小例子之基于cookie实现定制显示数据条数"></a>1.3 小例子之基于cookie实现定制显示数据条数</h2><ul>
<li><p>html内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/js/jquery-3.3.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/js/jquery.cookie.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        .page &#123;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            padding: 5px;</span><br><span class="line">            background-color: cyan;</span><br><span class="line">            margin: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        .active &#123;</span><br><span class="line">            background-color: black;</span><br><span class="line">            color: white;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for i in li %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123; all_page &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"ps"</span> <span class="attr">onchange</span>=<span class="string">"changePageSize(this)"</span>&gt;</span>    <span class="comment">&lt;!--绑定一个onchange事件--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"10"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"30"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"50"</span>&gt;</span>50<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"100"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        $(function()&#123;</span><br><span class="line">            var v = $.cookie('per_page_count');</span><br><span class="line">            $('#ps').val(v);</span><br><span class="line">        &#125;)</span><br><span class="line">        function changePageSize(ths) &#123;</span><br><span class="line">            var v = $(ths).val();</span><br><span class="line">            console.log(v);</span><br><span class="line">            $.cookie('per_page_count',v);</span><br><span class="line">            location.reload();</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>py文件：这个改动很少，只是传值了，将刚才的类我们直接拿过来用</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    li = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10000</span>+<span class="number">1</span>):</span><br><span class="line">        li.append(i)</span><br><span class="line">    current_page = int(request.GET.get(<span class="string">'p'</span>,<span class="number">1</span>)) <span class="comment"># 获取当前页码</span></span><br><span class="line">    dis_page_val = request.COOKIES.get(<span class="string">'per_page_count'</span>) <span class="comment"># 获取页码的cookie</span></span><br><span class="line">    print(dis_page_val)</span><br><span class="line">    page_obj = Page(current_page,len(li),dis_page_val)</span><br><span class="line">    data = li[page_obj.start():page_obj.end()] <span class="comment"># 数据</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'user_list.html'</span>,&#123;<span class="string">'li'</span>:data,<span class="string">'all_page'</span>:page_obj.page_str()&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,current_page,data_count,dis_data=<span class="number">10</span>,dis_page=<span class="number">10</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        current_page:传过来的当前页的值</span></span><br><span class="line"><span class="string">        data_count:数据总个数</span></span><br><span class="line"><span class="string">            dis_data:要显示的数据个数,默认为10</span></span><br><span class="line"><span class="string">            dis_page:要显示的页数,默认为10</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.current_page = current_page</span><br><span class="line">        self.data_count = data_count</span><br><span class="line">        self.dis_data = int(dis_data)</span><br><span class="line">        self.dis_page = dis_page</span><br><span class="line">        total_page = divmod(int(self.data_count),self.dis_data)</span><br><span class="line">        self.total_page = (total_page[<span class="number">0</span>] <span class="keyword">if</span> total_page[<span class="number">1</span>] == <span class="number">0</span> <span class="keyword">else</span> total_page[<span class="number">0</span>]+<span class="number">1</span>) <span class="comment"># 取出如果有余数则总页码加一</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.dis_data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.dis_data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_str</span><span class="params">(self)</span>:</span></span><br><span class="line">        page_list = []</span><br><span class="line">        start_index = <span class="number">1</span></span><br><span class="line">        end_index = self.dis_page + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.total_page &lt; end_index:</span><br><span class="line">            end_index = self.total_page + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> self.current_page &gt;<span class="number">5</span> <span class="keyword">and</span> self.current_page +<span class="number">5</span> &lt;= self.total_page:</span><br><span class="line">            start_index = self.current_page - <span class="number">4</span></span><br><span class="line">            end_index = self.current_page + <span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> self.current_page &lt;= <span class="number">5</span>:</span><br><span class="line">            start_index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start_index = self.total_page - <span class="number">9</span></span><br><span class="line">            end_index = self.total_page + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.current_page == <span class="number">1</span>:</span><br><span class="line">            prev = <span class="string">'&lt;a class="page" href="javascript:void(0);"&gt;上一页&lt;/a&gt;'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev = <span class="string">'&lt;a class="page" href="/user_list/?p=%s"&gt;上一页&lt;/a&gt;'</span> %(self.current_page<span class="number">-1</span>,)</span><br><span class="line">        page_list.append(prev)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(start_index,end_index):</span><br><span class="line">            <span class="keyword">if</span> i == self.current_page:</span><br><span class="line">                temp = <span class="string">'&lt;a class="page active" href="/user_list/?p=%s"&gt;%s&lt;/a&gt;'</span> % (i,i)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = <span class="string">'&lt;a class="page" href="/user_list/?p=%s"&gt;%s&lt;/a&gt;'</span> % (i,i)</span><br><span class="line">            page_list.append(temp)</span><br><span class="line">        <span class="keyword">if</span> self.current_page == self.total_page:</span><br><span class="line">            nex = <span class="string">'&lt;a class="page" href="javascript:void(0);"&gt;下一页&lt;/a&gt;'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nex = <span class="string">'&lt;a class="page" href="/user_list/?p=%s"&gt;下一页&lt;/a&gt;'</span> % (self.current_page+<span class="number">1</span>)</span><br><span class="line">        page_list.append(nex)</span><br><span class="line">        page_str = <span class="string">""</span>.join(page_list)</span><br><span class="line">        page_str = mark_safe(page_str)</span><br><span class="line">        <span class="keyword">return</span> page_str</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="1-4-代签名的Cookie"><a href="#1-4-代签名的Cookie" class="headerlink" title="1.4 代签名的Cookie"></a>1.4 代签名的Cookie</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj = HttpResponse(<span class="string">'签名'</span>)</span><br><span class="line">obj.set_signed_cookie(<span class="string">'user'</span>,<span class="string">'root'</span>,salt=<span class="string">'hehe'</span>) <span class="comment"># 这个salt就是签名</span></span><br><span class="line">obj.get_signed_cookie(<span class="string">'user'</span>,<span class="string">'root'</span>,salt=<span class="string">'hehe'</span>) <span class="comment"># 获取cookie也要根据这个签名来获取</span></span><br></pre></td></tr></table></figure>

<h1 id="2-Session"><a href="#2-Session" class="headerlink" title="2 Session"></a>2 Session</h1><h2 id="2-1-Session-原理"><a href="#2-1-Session-原理" class="headerlink" title="2.1 Session 原理"></a>2.1 Session 原理</h2><pre><code>session是保存在服务端的键值对</code></pre><h2 id="2-2-小例子"><a href="#2-2-小例子" class="headerlink" title="2.2 小例子"></a>2.2 小例子</h2><ul>
<li><p>py文件</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = request.POST.get(<span class="string">'user'</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">'pwd'</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">'root'</span> <span class="keyword">and</span> pwd ==<span class="string">'123'</span>:</span><br><span class="line">            request.session[<span class="string">'username'</span>] = user <span class="comment"># 这就是设置了一个session,这就完了，就这么简单，剩下的django都帮我做了</span></span><br><span class="line">            <span class="comment"># django将这个session信息放到了库里,会生成一个表，名为django_session</span></span><br><span class="line">            request.session[<span class="string">'is_login'</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/index/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.session[<span class="string">'is_login'</span>]:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'OK'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'NO'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>html</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'user'</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'pwd'</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-3-其他操作"><a href="#2-3-其他操作" class="headerlink" title="2.3 其他操作"></a>2.3 其他操作</h2><h3 id="2-3-1-数据库session"><a href="#2-3-1-数据库session" class="headerlink" title="2.3.1 数据库session"></a>2.3.1 数据库session</h3><p><strong>Django默认支持Session，并且默认是将Session数据存储在数据库中，即：django_session 表中。</strong></p>
<ul>
<li>a. 配置 settings.py    <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.db'</span>   <span class="comment"># 引擎（默认）</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                       <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span></span><br><span class="line">SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                               <span class="comment"># Session的cookie保存的路径（默认）</span></span><br><span class="line">SESSION_COOKIE_DOMAIN = <span class="literal">None</span>                             <span class="comment"># Session的cookie保存的域名（默认）</span></span><br><span class="line">SESSION_COOKIE_SECURE = <span class="literal">False</span>                            <span class="comment"># 是否Https传输cookie（默认）</span></span><br><span class="line">SESSION_COOKIE_HTTPONLY = <span class="literal">True</span>                           <span class="comment"># 是否Session的cookie只支持http传输（默认）</span></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span>                             <span class="comment"># Session的cookie失效日期（2周）（默认）</span></span><br><span class="line">SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="literal">False</span>                  <span class="comment"># 是否关闭浏览器使得Session过期（默认）</span></span><br><span class="line">SESSION_SAVE_EVERY_REQUEST = <span class="literal">False</span>                       <span class="comment"># 是否每次请求都保存Session，默认修改之后才保存（默认）</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>b. 使用<br>    <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 获取、设置、删除Session中数据</span></span><br><span class="line">    request.session[<span class="string">'k1'</span>]</span><br><span class="line">    request.session.get(<span class="string">'k1'</span>,<span class="literal">None</span>)</span><br><span class="line">    request.session[<span class="string">'k1'</span>] = <span class="number">123</span></span><br><span class="line">    request.session.setdefault(<span class="string">'k1'</span>,<span class="number">123</span>) <span class="comment"># 存在则不设置</span></span><br><span class="line">    <span class="keyword">del</span> request.session[<span class="string">'k1'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 所有 键、值、键值对</span></span><br><span class="line">    request.session.keys()</span><br><span class="line">    request.session.values()</span><br><span class="line">    request.session.items()</span><br><span class="line">    request.session.iterkeys()</span><br><span class="line">    request.session.itervalues()</span><br><span class="line">    request.session.iteritems()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户session的随机字符串</span></span><br><span class="line">    request.session.session_key</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将所有Session失效日期小于当前日期的数据删除</span></span><br><span class="line">    request.session.clear_expired()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查 用户session的随机字符串 在数据库中是否</span></span><br><span class="line">    request.session.exists(<span class="string">"session_key"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除当前用户的所有Session数据</span></span><br><span class="line">    request.session.delete(<span class="string">"session_key"</span>)</span><br><span class="line"></span><br><span class="line">    request.session.set_expiry(value)</span><br><span class="line">        * 如果value是个整数，session会在些秒数后失效。</span><br><span class="line">        * 如果value是个datatime或timedelta，session就会在这个时间后失效。</span><br><span class="line">        * 如果value是<span class="number">0</span>,用户关闭浏览器session就会失效。</span><br><span class="line">        * 如果value是<span class="literal">None</span>,session会依赖全局session失效策略。</span><br></pre></td></tr></table></figure></p>
<h2 id="2-3-2-缓存session"><a href="#2-3-2-缓存session" class="headerlink" title="2.3.2 缓存session"></a>2.3.2 缓存session</h2><ul>
<li>配置 settings.py  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span>  <span class="comment"># 引擎</span></span><br><span class="line">SESSION_CACHE_ALIAS = <span class="string">'default'</span>                            <span class="comment"># 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                        <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span></span><br><span class="line">SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                                <span class="comment"># Session的cookie保存的路径</span></span><br><span class="line">SESSION_COOKIE_DOMAIN = <span class="literal">None</span>                              <span class="comment"># Session的cookie保存的域名</span></span><br><span class="line">SESSION_COOKIE_SECURE = <span class="literal">False</span>                             <span class="comment"># 是否Https传输cookie</span></span><br><span class="line">SESSION_COOKIE_HTTPONLY = <span class="literal">True</span>                            <span class="comment"># 是否Session的cookie只支持http传输</span></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span>                              <span class="comment"># Session的cookie失效日期（2周）</span></span><br><span class="line">SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="literal">False</span>                   <span class="comment"># 是否关闭浏览器使得Session过期</span></span><br><span class="line">SESSION_SAVE_EVERY_REQUEST = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-3-3-文件session"><a href="#2-3-3-文件session" class="headerlink" title="2.3.3 文件session"></a>2.3.3 文件session</h3><ul>
<li>配置 settings.py  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.file'</span>    <span class="comment"># 引擎</span></span><br><span class="line">SESSION_FILE_PATH = <span class="literal">None</span>                                    <span class="comment"># 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()                                                            # 如：/var/folders/d3/j9tj0gz93dg06bmwxmhh6_xm0000gn/T</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                          <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span></span><br><span class="line">SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                                  <span class="comment"># Session的cookie保存的路径</span></span><br><span class="line">SESSION_COOKIE_DOMAIN = <span class="literal">None</span>                                <span class="comment"># Session的cookie保存的域名</span></span><br><span class="line">SESSION_COOKIE_SECURE = <span class="literal">False</span>                               <span class="comment"># 是否Https传输cookie</span></span><br><span class="line">SESSION_COOKIE_HTTPONLY = <span class="literal">True</span>                              <span class="comment"># 是否Session的cookie只支持http传输</span></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span>                                <span class="comment"># Session的cookie失效日期（2周）</span></span><br><span class="line">SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="literal">False</span>                     <span class="comment"># 是否关闭浏览器使得Session过期</span></span><br><span class="line">SESSION_SAVE_EVERY_REQUEST = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-3-4-缓存-数据库Session"><a href="#2-3-4-缓存-数据库Session" class="headerlink" title="2.3.4 缓存+数据库Session"></a>2.3.4 缓存+数据库Session</h3><p>数据库用于做持久化，缓存用于提高效率  </p>
<ul>
<li>配置 settings.py  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cached_db'</span>        <span class="comment"># 引擎</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-3-5-加密cookie-session"><a href="#2-3-5-加密cookie-session" class="headerlink" title="2.3.5 加密cookie session"></a>2.3.5 加密cookie session</h3><ul>
<li>配置 settings.py  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.signed_cookies'</span>   <span class="comment"># 引擎</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-4-更多"><a href="#2-4-更多" class="headerlink" title="2.4 更多"></a>2.4 更多</h2><p><a href="https://docs.djangoproject.com/en/1.9/topics/http/sessions/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.9/topics/http/sessions/</a><br><a href="https://docs.djangoproject.com/en/1.9/ref/settings/#settings-sessions" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.9/ref/settings/#settings-sessions</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://faker-demoking.github.io/Python/Django/Cookie和Session.html" data-id="ck34suda7000hccurem816vsf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/10/08/index/">目录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Daniel<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>